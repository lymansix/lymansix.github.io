---
layout: post
title: '开发环境搭建的思考'
subtitle: '快速搭建一个好用的开发环境'
date: 2025-09-28
author: 'liuzhaowang'
header-style: text
tags: [dev, wsl]
---

> 一直以来都在寻找一个快速搭建开发环境的方案，比如 win to go，linux to go，docker 等，最后，结合实际工作情况，决定使用 win10 ltsc 和 wsl 与 wintogo 结合的方案，使用固态硬盘安装 wintogo。wintogo 方便使用，携带 u 盘便可以在大多数电脑运行（mac 除外），win10 的图形界面方便日常办公使用，wsl 中使用 ubuntu 搭建具体的开发环境，并开启 ssh 服务，提供本地及远程开发，搭建完成后导出 wsl 并上传到云盘备份

### 一、win10 配置

1. 安装 wintogo，参见([萝卜头 IT 论坛](https://bbs.luobotou.org/bstra/forum-88-1.html))
2. 激活系统[kms 激活](https://github.com/abbodi1406/KMS_VL_ALL_AIO)
3. 配置包管理器 scoop

   > 由于国内网络问题，故选择 gitee 镜像安装，[安装加速](https://gitee.com/scoop-installer/scoop)。
   > 由于近期 gitee 加速站移除了代理，考虑自建，当然也可以用别的加速地址，比如：[github proxy](https://github.akams.cn/)

   初次安装：

   ```sh
   # 脚本执行策略更改，默认自动同意
   Set-ExecutionPolicy RemoteSigned -scope CurrentUser -Force

   # 执行安装命令（默认安装在用户目录下，如需更改请执行“自定义安装目录”命令）
   iwr -useb scoop.201704.xyz | iex

   ## 自定义安装目录（注意将目录修改为合适位置)
   irm scoop.201704.xyz -outfile 'install.ps1'
   .\install.ps1 -ScoopDir 'D:\Scoop' -ScoopGlobalDir 'D:\GlobalScoopApps'
   ```

   已安装更换镜像

   ```sh
   # 更换scoop的repo地址
   scoop config SCOOP_REPO "https://gitee.com/scoop-installer/scoop"
   # 拉取新库地址
   scoop update
   ```

   配置代理

   ```sh

   # 添加代理 (其中scoop.201704.xyz已移除软件源加速功能，将默认302跳转）
   scoop config URL_PROXY "https://hk.gh-proxy.com"

   # 删除代理
   scoop config rm URL_PROXY
   ```

   添加仓库，参考[镜像库](https://gitee.com/scoop-installer)

   ```sh
   # 查看已知bucket
   scoop bucket known

   # 添加需要的bucket
   scoop bucket add main
   scoop bucket add extras
   scoop bucket add nerd-fonts
   ```

4. 安装常用软件
   ```sh
   # 压缩软件
   scoop install 7zip
   # everything文件搜索神器
   scoop install everything
   # 好用的截图工具
   scoop install snipaste
   # 微软出品的实用工具
   scoop install powertoys
   # 微软出品的终端
   scoop install windows-terminal
   # 安装一个nerdfont字体
   scoop install cascadia-code
   # 快速好用的shell
   scoop install nu
   # 好用路径跳转工具
   scoop install zoxide
   ```
5. 配置 nushell
   ```sh
    # 同步对应版本环境变量配置
    wget https://github.com/nushell/nushell/blob/0.93.0/crates/nu-utils/src/sample_config/default_env.nu
    # 同步对应版本配置文件
    wget https://github.com/nushell/nushell/blob/0.93.0/crates/nu-utils/src/sample_config/default_config.nu
    # 在config.nu中去除banner
    $env.config = {
      ...
      show_banner: false,
      edit_mode: emacs
      ...
    }
    # 安装oh-my-posh
    scoop install oh-my-posh
    # 生成oh-my-posh配置
    oh-my-posh init nu --config ~/scoop/apps/oh-my-posh/current/themes/huvix.omp.json
    # 在config.nu中加入以下配置
    source ~/.oh-my-posh.nu
    # 安装zoxide
    scoop install zoxide
    # 生成zoxide配置
    zoxide init nushell | save -f ~/.zoxide.nu
    # 在config.nu中加入以下配置
    source ~/.zoxide.nu
   ```

### 二、wsl 配置

1. wsl2 安装，参考官方：[wsl2 官方文档](https://learn.microsoft.com/en-us/windows/wsl/setup/environment)
2. windows terminal 配置

   > 可以开启 quake 模式，并开机启动：wt.exe -w \_quake
   > 编写 vbs 开启启动脚本，并将其放入到：shell:startup 路径

   ```vbs
    Set shell = CreateObject("Shell.Application")
    shell.ShellExecute "wt.exe","-w _quake","","",0
    WScript.Quit
   ```

3. ubuntu 安装

   > ubuntu 已提供官方支持的 wsl，可以从商店安装，或者直接去[官网](https://ubuntu.com/desktop/wsl)下载

   ```sh
   # 可以直接通过wsl文件导入使用
   wsl --import Ubuntu D:\wsl\ubuntu24 E:\wsl\ubuntu\ubuntu-24.04.3-wsl-amd64.wsl --version 2

   # 更换国内源
   vim /etc/apt/sources.list.d/ubuntu.sources
   ```

   ```properties
   # 阿里云
   Types: deb
   URIs: http://mirrors.aliyun.com/ubuntu/
   Suites: noble noble-updates noble-security
   Components: main restricted universe multiverse
   Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
   ```

   ```sh
   # 更新
   apt update
   apt upgrade
   ```

4. zsh 安装配置
   ```sh
   # -------- zsh 安装
   apt install -y zsh
   # 将 zsh 设置为默认 shell
   chsh -s /bin/zsh
   # 检查
   echo $SHELL
   # 返回 /usr/bin/zsh 即表示成功；若没成功，重启试试看
   # oh my zsh 安装配置
   wget https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh
   # 修改ohmyzsh的仓库地址为gitee
   REPO=${REPO:-ohmyzsh/ohmyzsh}
   REMOTE=${REMOTE:-https://github.com/${REPO}.git}
   # ====>
   REPO=${REPO:-mirrors/oh-my-zsh}
   REMOTE=${REMOTE:-https://gitee.com/${REPO}.git}
   # 给予运行权限
   chmod +x ./install.sh
   # 安装
   ./install.sh
   # 修改仓库地址
   cd ~/.oh-my-zsh
   git remote set-url origin https://gitee.com/mirrors/oh-my-zsh.git
   git pull
   # 配置插件
   apt install -y autojump # 跳转目录
   # 注意：使用了github代理地址
   git clone --depth 1 https://hk.gh-proxy.com/https://github.com/zsh-users/zsh-autosuggestions.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
   git clone --depth 1 https://hk.gh-proxy.com/https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
   git clone https://hk.gh-proxy.com/https://github.com/lukechilds/zsh-nvm ~/.oh-my-zsh/custom/plugins/zsh-nvm
   vim ~/.zshrc
   plugins=(
      git
      zsh-nvm
      autojump
      zsh-autosuggestions
      zsh-syntax-highlighting
   )
   # 安装powerlevel10k样式
   git clone --depth=1 https://hk.gh-proxy.com/https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/themes/powerlevel10k
   # 修改zsh主题
   ZSH_THEME="powerlevel10k/powerlevel10k"
   # 配置p10k
   p10k configure
   # 增加环境变量
   export PATH="~/.local/bin:$PATH"
   # 使用nvm自动切换功能
   export NVM_AUTO_USE=true
   # 使配置文件生效
   source ~/.zshrc
   ```
5. tailscale（组网）
   ```sh
   # 使用官方安装脚本安装
   curl -fsSL https://tailscale.com/install.sh | sh
   # 开机启动
   systemctl enable tailscaled
   # 可以连接自建headscale
   tailscale login --login-server https://headscale.xx.com
   ```
6. docker 安装配置
   ```sh
   # 安装docker所需依赖
   apt install apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release
   # 添加docker密钥
   curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
   # 添加阿里云docker仓库
   add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"
   # 安装docker及工具
   apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
   # 配置docker镜像源
   vim /etc/docker/daemon.json
   ```
   ```json
   {
     "registry-mirrors": [
       "https://docker.hpcloud.cloud",
       "https://docker.m.daocloud.io",
       "https://docker.unsee.tech",
       "https://docker.1panel.live",
       "http://mirrors.ustc.edu.cn",
       "https://docker.chenby.cn",
       "http://mirror.azure.cn",
       "https://dockerpull.org",
       "https://dockerhub.icu",
       "https://hub.rat.dev",
       "https://proxy.1panel.live",
       "https://docker.1panel.top",
       "https://docker.m.daocloud.io",
       "https://docker.1ms.run",
       "https://docker.ketches.cn"
     ]
   }
   ```
   ```sh
   # 启动/重启docker
   sudo systemctl daemon-reload
   #如果还没启动
   sudo systemctl start docker
   #如果已经启动
   sudo systemctl restart docker
   # docker开机自启
   sudo systemctl enable docker
   # 验证镜像加速是否修改 查看Registry Mirrors部分
   sudo docker info
   ```
7. golang 开发环境配置
   ```sh
   # 下载最新版go
   wget -c https://golang.google.cn/dl/go1.25.1.linux-amd64.tar.gz
   # 解压
   tar -C /usr/local -xzf go1.25.1.linux-amd64.tar.gz
   # 配置环境变量
   echo 'export GOROOT=/usr/local/go' >> ~/.zshrc
   echo 'export PATH=$PATH:$GOROOT/bin' >> ~/.zshrc
   echo 'export GOPROXY=https://goproxy.cn,direct' >> ~/.zshrc
   source ~/.zshrc
   ```
8. nodejs 开发环境配置
   ```sh
   # 配置环境变量
   echo 'export NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node' >> ~/.zshrc
   echo 'export NVM_IOJS_ORG_MIRROR=https://npmmirror.com/mirrors/iojs' >> ~/.zshrc
   source ~/.zshrc
   # 执行官方安装脚本
   wget https://hk.gh-proxy.com/https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh
   # 使用代理后，install文件会有127.0.0.1:12008相似地址，将该地址替换为github代理地址
   chmod +x ./install.sh
   ./install.sh
   # 配置shell启动
   echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.zshrc
   echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm' >> ~/.zshrc
   echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion' >> ~/.zshrc
   source ~/.zshrc
   # nvm常用命令
   nvm install 14 # 安装指定版本的node
   nvm use 14 # 切换到指定版本
   nvm alias default # 设置默认版本
   nvm uninstall 14 #卸载某版本
   nvm ls # 查看本机已安装版本
   nvm ls-remote # 查看可安装版本
   nvm current # 当前使用版本
   nvm reinstall-packages 16 # 迁移全局包（例如从16到18）
   # 自动切换
   nvm use # 读取.nvmrc自动切换
   nvm install # 如未安装则直接安装.nvmrc指定的版本
   # 安装旧版本14，方便开发历史遗留项目
   nvm install lts/fermium
   # 安装新版本22，用户开发新项目
   nvm install lts/jod
   # 配置npm镜像
   npm config set registry https://registry.npmmirror.com
   npm config set disturl=https://registry.npmmirror.com/-/binary/node
   # 安装pnpm、yarn并配置镜像
   wget https://get.pnpm.io/install.sh
   # 修改安装脚本中的地址，加快速度，将`https://registry.npmjs.org`替换为`https://registry.npmmirror.com`，github地址加上代理
   chmod +x ./install.sh
   ./install.sh
   pnpm config set registry https://registry.npmmirror.com
   ```
   最佳实践
   - 统一使用 LTS：`nvm install --lts && nvm alias default lts/*`
   - 每个项目放一个`.nvmrc`
   - 禁止使用`sudo npm -g`，需要的 cli 尽量 npx 或加到 devDependencies
   - 切换大版本后执行`nvm reinstall-packages`迁移常用全量包
9. rust 开发环境配置
   ```sh
   # 设置环境变量，将下载源设为国内源
   export RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static
   # 执行安装脚本
   sudo curl https://sh.rustup.rs -sSf | sh
   # 配置cargo镜像源
   cat << EOF | tee -a ${CARGO_HOME:-$HOME/.cargo}/config.toml
   [source.crates-io]
   replace-with = 'mirror'

   [source.mirror]
   registry = "sparse+https://mirrors.tuna.tsinghua.edu.cn/crates.io-index/"

   [registries.mirror]
   index = "sparse+https://mirrors.tuna.tsinghua.edu.cn/crates.io-index/"
   EOF
   ```
10. java 开发环境配置
    ```sh
    ...
    ```
11. 安装配置 neovim
    ```sh
    # use github proxy
    curl -LO https://hk.gh-proxy.com/https://github.com/neovim/neovim/releases/latest/download/nvim-linux-x86_64.tar.gz
    # unzip tar file
    tar -C /opt -xzf nvim-linux-x86_64.tar.gz
    # add env
    echo 'export PATH="$PATH:/opt/nvim-linux-x86_64/bin"' >> ~/.zshrc
    source ~/.zshrc
    # install lazyvim
    # required
    mv ~/.config/nvim{,.bak}
    # optional but recommended
    mv ~/.local/share/nvim{,.bak}
    mv ~/.local/state/nvim{,.bak}
    mv ~/.cache/nvim{,.bak}
    # clone the starter
    git clone https://hk.gh-proxy.com/https://github.com/LazyVim/starter ~/.config/nvim
    # setting proxy
    vim ~/.config/nvim/lua/config/lazy.lua
    ```
    ```lua
    local ghproxy = "https://hk.gh-proxy.com/"

    local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
    if not (vim.uv or vim.loop).fs_stat(lazypath) then
      local lazyrepo = ghproxy .."https://github.com/folke/lazy.nvim.git"
      local out = vim.fn.system({ "git", "clone", "--filter=blob:none", "--branch=stable", lazyrepo, lazypath })
      if vim.v.shell_error ~= 0 then
        vim.api.nvim_echo({
          { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
          { out, "WarningMsg" },
          { "\nPress any key to exit..." },
        }, true, {})
        vim.fn.getchar()
        os.exit(1)
      end
    end
    vim.opt.rtp:prepend(lazypath)

    require("lazy").setup({
      git = {
        url_format = ghproxy .. "https://github.com/%s.git",
      },
      spec = {
        -- add LazyVim and import its plugins
        { "LazyVim/LazyVim", import = "lazyvim.plugins" },
        -- import/override with your plugins
        { import = "plugins" },
      },
      defaults = {
        -- By default, only LazyVim plugins will be lazy-loaded. Your custom plugins will load during startup.
        -- If you know what you're doing, you can set this to `true` to have all your custom plugins lazy-loaded by default.
        lazy = false,
        -- It's recommended to leave version=false for now, since a lot the plugin that support versioning,
        -- have outdated releases, which may break your Neovim install.
        version = false, -- always use the latest git commit
        -- version = "*", -- try installing the latest stable version for plugins that support semver
      },
      install = { colorscheme = { "tokyonight", "habamax" } },
      checker = {
        enabled = true, -- check for plugin updates periodically
        notify = false, -- notify on update
      }, -- automatically check for plugin updates
      performance = {
        rtp = {
          -- disable some rtp plugins
          disabled_plugins = {
            "gzip",
            -- "matchit",
            -- "matchparen",
            -- "netrwPlugin",
            "tarPlugin",
            "tohtml",
            "tutor",
            "zipPlugin",
          },
        },
      },
    })
    ```
    ```sh
    # 如果最新版有问题，可以回退到指定版本
    vim ~/.config/nvim/lua/plugins/core.lua
    ```
    ```lua
    return {
      { "LazyVim/LazyVim", version = "14.15.0" },
    }
    ```
    ```sh
    # 删除部分文件，需要根据当前的系统调整路径
    rm -rf ~/.local/share/nvim/lazy/LazyVim
    rm -rf ~/.config/nvim/lazy-lock.json
    ```

11. niri窗口编译安装
    ```sh
    # 安装依赖
    sudo apt-get install -y gcc clang libudev-dev libgbm-dev libxkbcommon-dev libegl1-mesa-dev libwayland-dev libinput-dev libdbus-1-dev libsystemd-dev libseat-dev libpipewire-0.3-dev libpango1.0-dev libdisplay-info-dev
    # 克隆源码
    git clone https://github.com/YaLTeR/niri.git
    # 修改源文件
    cd niri
    vim src/backend/winit.rs
    ```
    ```rust
    impl Winit {
    pub fn new(
        config: Rc<RefCell<Config>>,
        event_loop: LoopHandle<State>,
    ) -> Result<Self, winit::Error> {
        let _span = tracy_client::span!("Winit::new");

        let builder = Window::default_attributes()
            .with_inner_size(LogicalSize::new(1280.0, 800.0))
            // .with_resizable(false)
            // 去除wsl装饰框
            .with_decorations(false)
            .with_title("niri");
    ```
    ```sh
    # 编译安装
    rustup default stable
    cargo install cargo-deb
    cargo deb
    sudo dpkg -i target/debian/niri_25.8.0-1_amd64.deb
    ```
12. 导出 wsl 压缩文件，上传到网盘
    ```sh
    wsl --export Ubuntu /path/to/back/ubuntu-backup-yydd.tar.xz --format tar.xz
    ```
